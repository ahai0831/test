# PC GitLab规范

## 基本原则

+ 以人为本：遵守规范化的流程，避免冗余的工作量；

+ 上游优先：对于hotfix类型的合并请求，必须直接合并到master上，保证通过；再根据需要向下游合并；

+ 持续交付：不允许直接向master提交；原则上，不建议向develope分支提交；向受保护分支的合并请求必须经过review，并保证通过。

## 遵守规范

+ master为受保护分支，仅接收来自develope和hotfix_*分支的合并请求；合并前必须保证通过review和全部测试；

+ develope分支从master拉取，为master的下游分支，仅接收master和其他功能分支的合并请求；合并前必须保证通过review，原则上不能通过测试的分支合并请求应打回；

+ 各功能分支（非master，develope，hotfix_*的分支）开发完毕，向develope分支合并前，做好rebase，原则上产生一个commit；如果代码量过于分散，建议创建复数个功能分支；

+ 多人协作开发同一个功能，应提前做好解耦，避免修改同一处导致冲突；对于“共用”的代码段，应提交到另一独立的分支中并合并到develope，再次将develope合并到正在开发的分支中；

+ 修复master上普遍存在的特定功能缺陷（定义，阻塞到测试流程，如崩溃、白页、功能不可用）时，建立hotfix_*分支，合并到master后，再次向下游分支合并（此处有一个区分：若缺陷仅存在于develope上，建议优先完成相关测试代码的编写，将此修复视作需紧急开发的功能分支，流程参见4）；

+ 发布特定版本时，选择从master的特定版本打tag;

## 注意事项

+ 建立分支前请先建立issue并关联，用于记录提交版本记录和问题

+ 分支命名规则请遵守：{WIP_开发者名}所属工作类型_#关联issue编号_分支描述
  
  举例：{WIP_tiany}feature_#130_improve_zlib_gn_support

+ 对于在个人工作分支上的多次提交记录，为保证主线分支提交记录干净整洁，创建mr前应该做好squash，保留单条合适且清晰明了的提交记录，特殊情况经达成一致可保留多条

+ 个人工作分支创建mr前应做好和当前最新develop分支的rebase on，若出现冲突则由mr发起者负责解决

+ 所有合并至developp分支的代码均应该经过严格的代码评审，包括但不限于小组交叉评审和Master评审

+ 小组交叉评审应该对代码质量和代码规范进行把控，对相关问题应该在对应位置comment并在关联issue中备案，mr发起者解决后应自行关闭当前mr，修改代码后重新发起mr

+ 个人工作分支发起mr时，应该描述相关信息，关联相关issue，并assign给对应的代码评审人，代码评审人评审通过后应comment适当描述并assign给master进行下一步评审

+ 对于迭代合作的开发的情形，应建立虚拟主线分支合作分支，开发者名标注coop，合作完成后发起mr

+ 开发者应定期清理远端仓库上的个人分支