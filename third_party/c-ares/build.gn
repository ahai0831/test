import("//third_party/third_template.gni")

library_version = "c-ares-1.15.0"

third_fetch_code("fetch_code") {
  csv_file = library_version + ".csv"

  # Take care of the suffix name
  package_file = library_version + ".tar.gz"
}

third_config("c-ares_internal") {
  include_dirs = []
  defines = []
  if (is_win) {
    defines += [
      "_WIN32_WINNT=0x0600",
      "CARES_BUILDING_LIBRARY",
      "CARES_STATICLIB",
    ]
  }
  if (is_mac) {
    defines += [
      "HAVE_AF_INET6",
      "HAVE_ARPA_INET_H",
      "HAVE_ARPA_NAMESER_COMPAT_H",
      "HAVE_ERRNO_H",
      "HAVE_GETENV",
      "HAVE_IOCTL_FIONBIO",
      "HAVE_LIMITS_H",
      "HAVE_NETDB_H",
      "HAVE_RECV",
      "HAVE_RECVFROM",
      "HAVE_SEND",
      "HAVE_STRUCT_ADDRINFO",
      "HAVE_STRUCT_SOCKADDR_IN6",
      "HAVE_STRUCT_TIMEVAL",
      "HAVE_SYS_IOCTL_H",
      "HAVE_WRITEV",
      "RECV_TYPE_ARG1=int",
      "RECV_TYPE_ARG2=void*",
      "RECV_TYPE_ARG3=size_t",
      "RECV_TYPE_ARG4=int",
      "RECV_TYPE_RETV=ssize_t",
      "SEND_QUAL_ARG2=const",
      "SEND_TYPE_ARG1=int",
      "SEND_TYPE_ARG2=void*",
      "SEND_TYPE_ARG3=size_t",
      "SEND_TYPE_ARG4=int",
      "SEND_TYPE_RETV=ssize_t",
    ]
  }
}

third_config("c-ares_using") {
  include_dirs = [ "." ]
  defines = [ "USE_ARES" ]
}

third_static_library("c-ares") {
  deps = [
    ":fetch_code",
  ]
  sources = [
    "ares__close_sockets.c",
    "ares__get_hostent.c",
    "ares__read_line.c",
    "ares__timeval.c",
    "ares_android.c",
    "ares_cancel.c",
    "ares_create_query.c",
    "ares_data.c",
    "ares_destroy.c",
    "ares_expand_name.c",
    "ares_expand_string.c",
    "ares_fds.c",
    "ares_free_hostent.c",
    "ares_free_string.c",
    "ares_gethostbyaddr.c",
    "ares_gethostbyname.c",
    "ares_getnameinfo.c",
    "ares_getsock.c",
    "ares_init.c",
    "ares_library_init.c",
    "ares_llist.c",
    "ares_mkquery.c",
    "ares_nowarn.c",
    "ares_options.c",
    "ares_parse_a_reply.c",
    "ares_parse_aaaa_reply.c",
    "ares_parse_mx_reply.c",
    "ares_parse_naptr_reply.c",
    "ares_parse_ns_reply.c",
    "ares_parse_ptr_reply.c",
    "ares_parse_soa_reply.c",
    "ares_parse_srv_reply.c",
    "ares_parse_txt_reply.c",
    "ares_platform.c",
    "ares_process.c",
    "ares_query.c",
    "ares_search.c",
    "ares_send.c",
    "ares_strcasecmp.c",
    "ares_strdup.c",
    "ares_strerror.c",
    "ares_strsplit.c",
    "ares_timeout.c",
    "ares_version.c",
    "ares_writev.c",
    "bitncmp.c",
    "inet_net_pton.c",
    "inet_ntop.c",
    "windows_port.c",
  ]

  if (is_mac) {
    sources += [
      "ares_getenv.c",
      "ares_getopt.c",
    ]
  }
  public = [
    "ares.h",
    "ares_build.h",
    "ares_rules.h",
    "ares_version.h",
  ]
  configs = [ ":c-ares_internal" ]
  public_configs = [ ":c-ares_using" ]
}
