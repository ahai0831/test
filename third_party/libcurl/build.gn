import("//third_party/third_template.gni")

library_version = "curl-7.65.3"

third_fetch_code("fetch_code") {
  csv_file = library_version + ".csv"

  # Take care of the suffix name
  package_file = library_version + ".tar.xz"
}

third_config("libcurl_internal") {
  include_dirs = [ "lib" ]
  defines = [ "BUILDING_LIBCURL" ]
  if (is_win) {
    defines += [
      "_WIN32_WINNT=0x0501",
      "WINVER=0x0501",
      "USE_WINDOWS_SSPI",
    ]
  }
  if (is_mac) {
    defines += [
      "CURL_STATICLIB",
      "HAVE_ERRNO_H",
      "HAVE_FCNTL_H",
      "HAVE_IOCTL_FIONBIO",
      "HAVE_LIBZ",
      "HAVE_LONGLONG",
      "HAVE_NETDB_H",
      "HAVE_RECV",
      "HAVE_SELECT",
      "HAVE_SEND",
      "HAVE_SOCKET",
      "HAVE_STRUCT_TIMEVAL",
      "HAVE_SYS_IOCTL_H",
      "HAVE_SYS_STAT_H",
      "HAVE_UNISTD_H",
      "HAVE_ZLIB_H",
      "OS=\"x86_64-apple-darwin18.7.0\"",
      "RECV_TYPE_ARG1=int",
      "RECV_TYPE_ARG2=void*",
      "RECV_TYPE_ARG3=size_t",
      "RECV_TYPE_ARG4=int",
      "RECV_TYPE_RETV=ssize_t",
      "SEND_QUAL_ARG2=const",
      "SEND_TYPE_ARG1=int",
      "SEND_TYPE_ARG2=void*",
      "SEND_TYPE_ARG3=size_t",
      "SEND_TYPE_ARG4=int",
      "SEND_TYPE_RETV=ssize_t",
      "SIZEOF_CURL_OFF_T=8",
      "SIZEOF_INT=4",
      "SIZEOF_LONG=8",
      "SIZEOF_SHORT=2",
      "SIZEOF_SIZE_T=8",
      "USE_ARES",
      "USE_SECTRANSP",  #associate with darwinssl
    ]
  }
}

third_config("libcurl_using") {
  include_dirs = [ "include" ]
  defines = [ "CURL_STATICLIB" ]
  if (is_win) {
    # Windows should be different.
    libs = [
      "ws2_32.lib",
      "wldap32.lib",
      "crypt32.lib",
    ]
  }
  if (is_mac) {
    libs = [
      "CoreFoundation.framework",
      "Security.framework",
      "LDAP.framework",
    ]
  }
}

third_static_library("libcurl") {
  deps = [
    ":fetch_code",
    "//third_party/c-ares",
    "//third_party/zlib",
  ]
  if (is_win) {
    deps += [ "//third_party/openssl" ]
  }
  sources = [
    "lib/altsvc.c",
    "lib/amigaos.c",
    "lib/asyn-ares.c",
    "lib/asyn-thread.c",
    "lib/base64.c",
    "lib/conncache.c",
    "lib/connect.c",
    "lib/content_encoding.c",
    "lib/cookie.c",
    "lib/curl_addrinfo.c",
    "lib/curl_ctype.c",
    "lib/curl_des.c",
    "lib/curl_endian.c",
    "lib/curl_fnmatch.c",
    "lib/curl_get_line.c",
    "lib/curl_gethostname.c",
    "lib/curl_gssapi.c",
    "lib/curl_memrchr.c",
    "lib/curl_multibyte.c",
    "lib/curl_ntlm_core.c",
    "lib/curl_ntlm_wb.c",
    "lib/curl_path.c",
    "lib/curl_range.c",
    "lib/curl_rtmp.c",
    "lib/curl_sasl.c",
    "lib/curl_sspi.c",
    "lib/curl_threads.c",
    "lib/dict.c",
    "lib/doh.c",
    "lib/dotdot.c",
    "lib/easy.c",
    "lib/escape.c",
    "lib/file.c",
    "lib/fileinfo.c",
    "lib/formdata.c",
    "lib/ftp.c",
    "lib/ftplistparser.c",
    "lib/getenv.c",
    "lib/getinfo.c",
    "lib/gopher.c",
    "lib/hash.c",
    "lib/hmac.c",
    "lib/hostasyn.c",
    "lib/hostcheck.c",
    "lib/hostip.c",
    "lib/hostip4.c",
    "lib/hostip6.c",
    "lib/hostsyn.c",
    "lib/http.c",
    "lib/http2.c",
    "lib/http_chunks.c",
    "lib/http_digest.c",
    "lib/http_negotiate.c",
    "lib/http_ntlm.c",
    "lib/http_proxy.c",
    "lib/idn_win32.c",
    "lib/if2ip.c",
    "lib/imap.c",
    "lib/inet_ntop.c",
    "lib/inet_pton.c",
    "lib/krb5.c",
    "lib/ldap.c",
    "lib/llist.c",
    "lib/md4.c",
    "lib/md5.c",
    "lib/memdebug.c",
    "lib/mime.c",
    "lib/mprintf.c",
    "lib/multi.c",
    "lib/netrc.c",
    "lib/non-ascii.c",
    "lib/nonblock.c",
    "lib/openldap.c",
    "lib/parsedate.c",
    "lib/pingpong.c",
    "lib/pop3.c",
    "lib/progress.c",
    "lib/psl.c",
    "lib/rand.c",
    "lib/rtsp.c",
    "lib/security.c",
    "lib/select.c",
    "lib/sendf.c",
    "lib/setopt.c",
    "lib/sha256.c",
    "lib/share.c",
    "lib/slist.c",
    "lib/smb.c",
    "lib/smtp.c",
    "lib/socks.c",
    "lib/socks_gssapi.c",
    "lib/socks_sspi.c",
    "lib/speedcheck.c",
    "lib/splay.c",
    "lib/ssh-libssh.c",
    "lib/ssh.c",
    "lib/strcase.c",
    "lib/strdup.c",
    "lib/strerror.c",
    "lib/strtok.c",
    "lib/strtoofft.c",
    "lib/system_win32.c",
    "lib/telnet.c",
    "lib/tftp.c",
    "lib/timeval.c",
    "lib/transfer.c",
    "lib/url.c",
    "lib/urlapi.c",
    "lib/vauth/cleartext.c",
    "lib/vauth/cram.c",
    "lib/vauth/digest.c",
    "lib/vauth/digest_sspi.c",
    "lib/vauth/krb5_gssapi.c",
    "lib/vauth/krb5_sspi.c",
    "lib/vauth/ntlm.c",
    "lib/vauth/ntlm_sspi.c",
    "lib/vauth/oauth2.c",
    "lib/vauth/spnego_gssapi.c",
    "lib/vauth/spnego_sspi.c",
    "lib/vauth/vauth.c",
    "lib/version.c",
    "lib/vtls/gskit.c",
    "lib/vtls/gtls.c",
    "lib/vtls/mbedtls.c",
    "lib/vtls/mesalink.c",
    "lib/vtls/nss.c",
    "lib/vtls/openssl.c",
    "lib/vtls/polarssl.c",
    "lib/vtls/polarssl_threadlock.c",
    "lib/vtls/schannel.c",
    "lib/vtls/schannel_verify.c",
    "lib/vtls/sectransp.c",
    "lib/vtls/vtls.c",
    "lib/vtls/wolfssl.c",
    "lib/warnless.c",
    "lib/wildcard.c",
    "lib/x509asn1.c",
  ]
  public = [
    "include/curl/curl.h",
    "include/curl/curlver.h",
    "include/curl/easy.h",
    "include/curl/mprintf.h",
    "include/curl/multi.h",
    "include/curl/stdcheaders.h",
    "include/curl/system.h",
    "include/curl/typecheck-gcc.h",
    "include/curl/urlapi.h",
    "lib/altsvc.h",
    "lib/amigaos.h",
    "lib/arpa_telnet.h",
    "lib/asyn.h",
    "lib/config-amigaos.h",
    "lib/config-dos.h",
    "lib/config-mac.h",
    "lib/config-os400.h",
    "lib/config-riscos.h",
    "lib/config-symbian.h",
    "lib/config-tpf.h",
    "lib/config-vxworks.h",
    "lib/config-win32.h",
    "lib/config-win32ce.h",
    "lib/conncache.h",
    "lib/connect.h",
    "lib/content_encoding.h",
    "lib/cookie.h",
    "lib/curl_addrinfo.h",
    "lib/curl_base64.h",
    "lib/curl_ctype.h",
    "lib/curl_des.h",
    "lib/curl_endian.h",
    "lib/curl_fnmatch.h",
    "lib/curl_get_line.h",
    "lib/curl_gethostname.h",
    "lib/curl_gssapi.h",
    "lib/curl_hmac.h",
    "lib/curl_ldap.h",
    "lib/curl_md4.h",
    "lib/curl_md5.h",
    "lib/curl_memory.h",
    "lib/curl_memrchr.h",
    "lib/curl_multibyte.h",
    "lib/curl_ntlm_core.h",
    "lib/curl_ntlm_wb.h",
    "lib/curl_path.h",
    "lib/curl_printf.h",
    "lib/curl_range.h",
    "lib/curl_rtmp.h",
    "lib/curl_sasl.h",
    "lib/curl_sec.h",
    "lib/curl_setup.h",
    "lib/curl_setup_once.h",
    "lib/curl_sha256.h",
    "lib/curl_sspi.h",
    "lib/curl_threads.h",
    "lib/curlx.h",
    "lib/dict.h",
    "lib/doh.h",
    "lib/dotdot.h",
    "lib/easyif.h",
    "lib/escape.h",
    "lib/file.h",
    "lib/fileinfo.h",
    "lib/formdata.h",
    "lib/ftp.h",
    "lib/ftplistparser.h",
    "lib/getinfo.h",
    "lib/gopher.h",
    "lib/hash.h",
    "lib/hostcheck.h",
    "lib/hostip.h",
    "lib/http.h",
    "lib/http2.h",
    "lib/http_chunks.h",
    "lib/http_digest.h",
    "lib/http_negotiate.h",
    "lib/http_ntlm.h",
    "lib/http_proxy.h",
    "lib/if2ip.h",
    "lib/imap.h",
    "lib/inet_ntop.h",
    "lib/inet_pton.h",
    "lib/llist.h",
    "lib/memdebug.h",
    "lib/mime.h",
    "lib/multihandle.h",
    "lib/multiif.h",
    "lib/netrc.h",
    "lib/non-ascii.h",
    "lib/nonblock.h",
    "lib/parsedate.h",
    "lib/pingpong.h",
    "lib/pop3.h",
    "lib/progress.h",
    "lib/psl.h",
    "lib/rand.h",
    "lib/rtsp.h",
    "lib/select.h",
    "lib/sendf.h",
    "lib/setopt.h",
    "lib/setup-os400.h",
    "lib/setup-vms.h",
    "lib/share.h",
    "lib/sigpipe.h",
    "lib/slist.h",
    "lib/smb.h",
    "lib/smtp.h",
    "lib/sockaddr.h",
    "lib/socks.h",
    "lib/speedcheck.h",
    "lib/splay.h",
    "lib/ssh.h",
    "lib/strcase.h",
    "lib/strdup.h",
    "lib/strerror.h",
    "lib/strtok.h",
    "lib/strtoofft.h",
    "lib/system_win32.h",
    "lib/telnet.h",
    "lib/tftp.h",
    "lib/timeval.h",
    "lib/transfer.h",
    "lib/url.h",
    "lib/urlapi-int.h",
    "lib/urldata.h",
    "lib/vauth/digest.h",
    "lib/vauth/ntlm.h",
    "lib/vauth/vauth.h",
    "lib/vtls/gskit.h",
    "lib/vtls/gtls.h",
    "lib/vtls/mbedtls.h",
    "lib/vtls/mesalink.h",
    "lib/vtls/nssg.h",
    "lib/vtls/openssl.h",
    "lib/vtls/polarssl.h",
    "lib/vtls/polarssl_threadlock.h",
    "lib/vtls/schannel.h",
    "lib/vtls/sectransp.h",
    "lib/vtls/vtls.h",
    "lib/vtls/wolfssl.h",
    "lib/warnless.h",
    "lib/wildcard.h",
    "lib/x509asn1.h",
  ]
  configs = [ ":libcurl_internal" ]
  public_configs = [ ":libcurl_using" ]
}
